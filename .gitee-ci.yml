# Gitee流水线配置

stages:
  - install
  - scrape
  - update

install_dependencies:
  stage: install
  tags:
    - docker
  image: ubuntu:latest
  script:
    - echo "=== 安装系统依赖 ==="
    - apt-get update && apt-get install -y python3 python3-pip
    - echo "=== 安装Python依赖 ==="
    - pip3 install --upgrade pip
    - pip3 install -r requirements.txt

run_scraper:
  stage: scrape
  tags:
    - docker
  image: ubuntu:latest
  script:
    - echo "=== 执行太阳能数据爬虫脚本 ==="
    - python3 main.py
  artifacts:
    paths:
      - data/

update_repository:
  stage: update
  tags:
    - docker
  image: ubuntu:latest
  script:
    - echo "=== 配置Git环境 ==="
    - apt-get update && apt-get install -y git
    - git config --global user.name "Gitee CI"
    - git config --global user.email "ci@example.com"
    - echo "=== 提交更新 ==="
    - git add data/*.json
    - git commit -m "自动更新太阳能数据 $(date +%Y-%m-%d)"
  only:
    - main
  dependencies:
    - run_scraper